<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bienvenido </title>
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=getMapa' async defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type='text/javascript'>
    // clave de bing: AqF8_BsEjsHhq8t5joDysX5hR6IgQILterGBHZdqRkIDA46XaKr-estp9FIa3v3b
    var currentPushpin = null;  // Guarda una referencia al marcador actual

    function getMapa() {
        var mapa = new Microsoft.Maps.Map('#miMapa', {
            credentials: 'AqF8_BsEjsHhq8t5joDysX5hR6IgQILterGBHZdqRkIDA46XaKr-estp9FIa3v3b'
        });

        // Agrega un controlador de eventos de clic al mapa
        Microsoft.Maps.Events.addHandler(mapa, 'click', function(e) {
            // Obtiene la ubicación del clic
            var ubicacion = e.location;

            // Si hay un marcador actual, lo elimina del mapa
            if (currentPushpin) {
                mapa.entities.remove(currentPushpin);
            }

            // Crea un nuevo marcador en la ubicación del clic
            currentPushpin = new Microsoft.Maps.Pushpin(ubicacion, null);
            mapa.entities.push(currentPushpin);
            
            // Actualiza los campos ocultos del formulario con la latitud y longitud
            $('#latitud').val(ubicacion.latitude);
            $('#longitud').val(ubicacion.longitude);
          });
    }
    </script>
    <link rel="icon" href="{{ url_for('static', filename='logo.jpeg') }}" type="image/jpeg">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div id="crearEventoForm">
      <h2>Crear Evento</h2>
      <!-- Se muestra el nombre del evento seleccionado Fiesta, Concierto o Match -->
      <h1>{{context.evento}}</h1>
      <!-- Se manejan los mensajes de entradas no validas -->
      {% with mensajes = get_flashed_messages() %}
      {% if mensajes %}
        <ul class=flashes>
        {% for mensaje in mensajes %}
          <li>{{ mensaje }}</li>
        {% endfor %}
        </ul>
      {% endif %}
      {% endwith %}
      <form method="POST", action="/crearEvento">
        <div class="inputGrupo">
          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" name="nombre"><br>
        </div>
        <div class="inputGrupo">  
          <label for="descripcion">Descripción:</label>
          <input type="text" id="descripcion" name="descripcion"><br>
        </div>
        <div class="inputGrupo">
          <label for="fecha">Fecha:</label>
          <input type="date" id="fecha" name="fecha"><br>
        </div>
        <div class="inputGrupo">
          <label for="fechaFin">Fecha de finalización:</label>
          <input type="date" id="fechaFin" name="fechaFin"><br>
        </div>
        <div class="inputGrupo"> 
        <label for="ubicacion">Ubicación:</label>
        <input type="text" id="descripcionUbi" name="descripcionUbi"><br>
        </div>
        <div id="miMapa" style="position:relative;width:350px;height:350px;"></div>
        <!-- Campos ocultos para la latitud y longitud seleccionada -->
        <input type="hidden" id="latitud" name="latitud">
        <input type="hidden" id="longitud" name="longitud">
        <br>
        <div class="inputGrupo">
          <label for="precio">Precio de entrada:</label>
          <input type="number" id="precio" name="precio" min="0"><br>
        </div>
        <div class="inputGrupo">
          <label for="capacidad">Capacidad:</label>
          <input type="number" id="capacidad" name="capacidad" min="1"><br>
        </div>
        <div class="inputGrupo">
          <label for="edadMin">Edad mínima:</label>
          <input type="number" id="edadMin" name="edadMin" min="13"><br>
        </div>
        <div class="inputGrupo">
          <label for="edadMax">Edad máxima:<br>(100 = sin límite)</label>
          <input type="number" id="edadMax" name="edadMax" min="14"><br>
        </div>
        {% if context.evento == 'Fiesta' %}
        <div class="inputGrupo">  
          <label for="vestimenta">Vestimenta:</label>
          <input type="text" id="vestimenta" name="vestimenta"><br>
        </div>
        <div class="inputGrupo">  
          <label for="categoria">Categoría:</label>
          <input type="text" id="categoria" name="categoria"><br>
        </div>
        <div class="selectGrupo">
          <label for="bar">Bar:</label>
          <select name="bar">
            <option value="SI">Sí</option>
            <option value="NO">No</option>
          </select>
        </div>
        <div class="selectGrupo">
          <label for="conservadora">Conservadora:</label>
          <select name="conservadora">
            <option value="SI">Sí</option>
            <option value="NO">No</option>
          </select>
        </div>
        <div class="selectGrupo">
          <label for="bandas">Bandas:</label>
          <select name="bandas">
            <option value="BANDA1">BANDA1</option>
            <option value="BANDA2">BANDA2</option>
          </select>
        </div>
        {% elif context.evento == 'Concierto' %}
        <label for="descripcion">Descripción:</label>
        {% elif context.evento == 'Match' %}
        <label for="descripcion">Descripción:</label>
        {% endif %}
          <button type="submit">Crear {{context.evento}}</button>
      </form>
    </div>
    <form method="POST", action="/crearBanda">
      <div id="crearEventoForm">
      </div>
    </form>
    <p id="pie">Grupo 2</p>
</body>
</html>
